-- **Ki·ªÉm tra map**
local GameID = game.PlaceId

if GameID ~= 13772394625 then
    game.Players.LocalPlayer:Kick("‚ö† Script kh√¥ng ho·∫°t ƒë·ªông cho map n√†y!")
    return
end

-- **üîπ T·∫£i th∆∞ vi·ªán Orion UI**
local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/jensonhirst/Orion/main/source"))()
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- **üìå T·∫£i danh s√°ch ban t·ª´ URL**
local BanData
local success, response = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/Chubedan3/TH/refs/heads/main/Ban", true)
end)

if success and response then
    local successLoad, data = pcall(loadstring(response))
    if successLoad and type(data) == "table" then
        BanData = data
    end
end

if not BanData then
    BanData = { BanVinhVien = {}, BanTamThoi = {} }
end

-- **üõë Ki·ªÉm tra n·∫øu ng∆∞·ªùi ch∆°i b·ªã ban**
local function KiemTraBan()
    local UserID = LocalPlayer.UserId

    for _, ID in pairs(BanData.BanVinhVien) do
        if UserID == ID then
            LocalPlayer:Kick("üö´ B·∫°n ƒë√£ b·ªã ban vƒ©nh vi·ªÖn kh·ªèi Thanh Hub!")
            return
        end
    end

    if BanData.BanTamThoi[UserID] then
        if os.time() < BanData.BanTamThoi[UserID] then
            LocalPlayer:Kick("‚è≥ B·∫°n b·ªã ban t·∫°m th·ªùi trong 1 ng√†y! H√£y th·ª≠ l·∫°i sau.")
            return
        else
            BanData.BanTamThoi[UserID] = nil
        end
    end
end

KiemTraBan()

-- **üìå Ki·ªÉm tra ng∆∞·ªùi d√πng v√† g·ª≠i Webhook**
local WebhookURL = "https://discord.com/api/webhooks/1339200430579908619/pj8_QCHfvDXJgW2j0sJadTXByc5vn5X0LMFnilsdqszYHdAHPbedmaACJhdwdnKbtvY6"
local Executor = identifyexecutor and identifyexecutor() or "Kh√¥ng x√°c ƒë·ªãnh"
local TenNguoiChoi = LocalPlayer.Name
local IDNguoiChoi = LocalPlayer.UserId
local AvatarURL = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. IDNguoiChoi .. "&width=420&height=420&format=png"

local DuLieu = {
    ["username"] = "Thanh Hub Webhook",
    ["embeds"] = {{
        ["title"] = "üîç Ki·ªÉm tra ng∆∞·ªùi ch∆°i (t·ª´ Blade Ball)",
        ["description"] = "**T√™n ng∆∞·ªùi ch∆°i:** " .. TenNguoiChoi ..  
                         "\n**ID:** " .. IDNguoiChoi ..  
                         "\n**Executor:** " .. Executor,
        ["color"] = 16776960,
        ["thumbnail"] = { ["url"] = AvatarURL }
    }}
}

local function sendRequest(data)
    local httpRequest = http and http.request or syn and syn.request or request
    if httpRequest then
        httpRequest({
            Url = WebhookURL,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode(data)
        })
    end
end

pcall(function() sendRequest(DuLieu) end)

local function CapNhatDanhSachNguoiChoi()
    DanhSachNguoiChoi = {}
    for _, player in pairs(game.Players:GetPlayers()) do
        if player ~= game.Players.LocalPlayer then
            table.insert(DanhSachNguoiChoi, player.Name)
        end
    end
    OrionLib:MakeNotification({
        Name = "‚úÖ ƒê√£ C·∫≠p Nh·∫≠t",
        Content = "Danh s√°ch ng∆∞·ªùi ch∆°i ƒë√£ ƒë∆∞·ª£c l√†m m·ªõi!",
        Image = "rbxassetid://4483345998",
        Time = 3
    })
end

-- **üìå Giao di·ªán Orion UI**
local CuaSo = OrionLib:MakeWindow({
    Name = "Thanh Hub | Blade Ball | v0.3 (Beta) | Th·ª≠ nghi·ªám",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "ThanhHubBB",
    IntroEnabled = false,
    Size = UDim2.new(0, 400, 0, 250),
    Draggable = true
})

-- **üè† Tab Ch√≠nh**
local TabChinh = CuaSo:MakeTab({ Name = "üè† Trang Ch√≠nh", Icon = "rbxassetid://4483345998" })
TabChinh:AddParagraph("üîπ Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Thanh Hub Blade Ball!")
TabChinh:AddParagraph("Ph·∫ßn Ch√≠nh s·∫Ω ƒë∆∞·ª£c update th√™m sau:3")

-- **‚öî Tab Chi·∫øn ƒê·∫•u**
local TabChienDau = CuaSo:MakeTab({ Name = "‚öî Chi·∫øn ƒê·∫•u", Icon = "rbxassetid://4483345998" })

local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")

local Player = Players.LocalPlayer
local Cooldown = tick()
local IsParried = false
local Connection = nil
local AutoParryEnabled = false
local SpamToggleEnabled = false
local AntiCurveEnabled = false
local SpamButton = nil

-- **üîç H√†m t√¨m b√≥ng th·∫≠t**
local function GetBall()
    for _, Ball in ipairs(workspace.Balls:GetChildren()) do
        if Ball:GetAttribute("realBall") then
            return Ball
        end
    end
end

-- **üîÑ Reset k·∫øt n·ªëi khi b√≥ng m·ªõi xu·∫•t hi·ªán**
local function ResetConnection()
    if Connection then
        Connection:Disconnect()
        Connection = nil
    end
end

workspace.Balls.ChildAdded:Connect(function()
    if not AutoParryEnabled then return end
    local Ball = GetBall()
    if not Ball then return end
    ResetConnection()
    Connection = Ball:GetAttributeChangedSignal("target"):Connect(function()
        IsParried = false
    end)
end)

-- **üõ° Auto Parry + Fix Anti Curve**
RunService.PreSimulation:Connect(function()
    if not AutoParryEnabled then return end

    local Ball = GetBall()
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Ball or not HRP then return end

    local Speed = Ball.zoomies.VectorVelocity.Magnitude
    local Distance = (HRP.Position - Ball.Position).Magnitude

    -- **üéØ Fix Anti Curve: Nh·∫≠n di·ªán s·ª± chuy·ªÉn ƒë·ªïi h∆∞·ªõng ƒëi c·ªßa b√≥ng**
    if AntiCurveEnabled then
        local BallVelocity = Ball.zoomies.VectorVelocity
        local BallDirection = BallVelocity.Unit
        local PlayerDirection = (HRP.Position - Ball.Position).Unit
        local Angle = BallDirection:Dot(PlayerDirection)

        -- N·∫øu b√≥ng ƒë·ªïi h∆∞·ªõng ƒë·ªôt ng·ªôt (> 20 ƒë·ªô), kh√¥ng parry qu√° s·ªõm
        if Angle < 0.9 then 
            return
        end
    end

    if Ball:GetAttribute("target") == Player.Name and not IsParried and Distance / Speed <= 0.55 then
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
        IsParried = true
        Cooldown = tick()
    end

    -- **‚è≥ Reset tr·∫°ng th√°i Parry**
    if (tick() - Cooldown) >= 1 then
        IsParried = false
    end
end)

-- **üñ≤Ô∏è T·∫°o N√∫t Spam Toggle**
local function CreateSpamButton()
    if SpamButton then return end

    SpamButton = Instance.new("TextButton")
    SpamButton.Name = "SpamToggle"
    SpamButton.Size = UDim2.new(0, 100, 0, 50)
    SpamButton.Position = UDim2.new(0.8, 0, 0.2, 0)
    SpamButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    SpamButton.Text = "Spam: OFF"
    SpamButton.Parent = game.CoreGui

    -- **üîò Cho ph√©p k√©o n√∫t nh∆∞ng kh√¥ng b·ªã k√©o ra ngo√†i m√†n h√¨nh**
    local Dragging = false
    local DragInput, MousePos, FramePos

    SpamButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            MousePos = input.Position
            FramePos = SpamButton.Position
        end
    end)

    SpamButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            local Delta = input.Position - MousePos
            local NewPos = UDim2.new(
                math.clamp(FramePos.X.Scale + Delta.X / game:GetService("Workspace").CurrentCamera.ViewportSize.X, 0, 0.9),
                0,
                math.clamp(FramePos.Y.Scale + Delta.Y / game:GetService("Workspace").CurrentCamera.ViewportSize.Y, 0, 0.9),
                0
            )
            SpamButton.Position = NewPos
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = false
        end
    end)

    -- **üñ±Ô∏è B·∫≠t/t·∫Øt Spam khi nh·∫•n n√∫t**
    SpamButton.MouseButton1Click:Connect(function()
        SpamToggleEnabled = not SpamToggleEnabled
        SpamButton.Text = SpamToggleEnabled and "Spam: ON" or "Spam: OFF"

        while SpamToggleEnabled do
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            task.wait()
        end
    end)
end

-- **üîò Th√™m Auto Parry, Spam Toggle & Anti Curve v√†o Tab Chi·∫øn ƒê·∫•u**
TabChienDau:AddToggle({
    Name = "üõ° Auto Ch√©m",
    Default = false,
    Callback = function(state)
        AutoParryEnabled = state
    end
})

TabChienDau:AddToggle({
    Name = "üéØ Anti B√≥ng Bay Ch√©o/L·ªách h∆∞·ªõng",
    Default = false,
    Callback = function(state)
        AntiCurveEnabled = state
    end
})

TabChienDau:AddToggle({
    Name = "‚ö° T·∫°o n√∫t Spam (s·∫Ω c√≥ trong b·∫£n ch√≠nh th·ª©c)",
    Default = false,
    Callback = function(state)
        hsysgshsyshssjjsjsjjsej = state
    end
})

-- **üó∫ Tab D·ªãch Chuy·ªÉn**
local TabDichChuyen = CuaSo:MakeTab({ Name = "üó∫ D·ªãch Chuy·ªÉn", Icon = "rbxassetid://4483345998" })

TabDichChuyen:AddButton({
    Name = "üöÄ D·ªãch chuy·ªÉn l√™n cao",
    Callback = function()
        local hrp = game.Players.LocalPlayer.Character.HumanoidRootPart
        hrp.CFrame = hrp.CFrame + Vector3.new(0, 50, 0)
    end
})

-- **‚öô Tab C√†i ƒê·∫∑t**
local TabCaiDat = CuaSo:MakeTab({ Name = "‚öô C√†i ƒê·∫∑t", Icon = "rbxassetid://4483345998" })
TabCaiDat:AddButton({
    Name = "üîÑ T·∫£i l·∫°i m√°y ch·ªß",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId, game.Players.LocalPlayer)
    end
})

local TabHoTro = CuaSo:MakeTab({ Name = "üì© Y√™u C·∫ßu/Tr·ª£ Gi√∫p", Icon = "rbxassetid://4483345998" })
TabHoTro:AddParagraph("H√£y nh·∫≠p y√™u c·∫ßu ho·∫∑c tr·ª£ gi√∫p v√†o ƒë√¢y", "Thanh Hub s·∫Ω xem x√©t v√† c·ªë g·∫Øng th·ª±c hi·ªán ho·∫∑c s·ª≠a l·ªói, l∆∞u √Ω kh√¥ng g·ª≠i nh·ªØng tin nh·∫Øn b·∫≠y b·∫° v√¨ n√≥ s·∫Ω ƒë∆∞·ª£c g·ª≠i cho Thanh Hub n·∫øu kh√¥ng b·∫°n s·∫Ω b·ªã ban kh·ªèi Thanh Hub 1 ng√†y, spam b·∫°n s·∫Ω 5 ti·∫øng")

local NoiDungYeuCau = ""
TabHoTro:AddTextbox({
    Name = "üìú Nh·∫≠p y√™u c·∫ßu ho·∫∑c tr·ª£ gi√∫p",
    Default = "",
    TextDisappear = false,
    Callback = function(value)
        NoiDungYeuCau = value
    end
})

-- **üõë H·ªá th·ªëng ƒë·∫øm s·ªë l·∫ßn g·ª≠i h·ªó tr·ª£**
local DemSoLanGui = {}
local ThoiGianHienTai = os.date("*t")

local function KiemTraGioiHan(NguoiChoi)
    local IDNguoiChoi = NguoiChoi.UserId
    if not DemSoLanGui[IDNguoiChoi] then
        DemSoLanGui[IDNguoiChoi] = { SoLan = 0, Ngay = ThoiGianHienTai.day }
    end

    if DemSoLanGui[IDNguoiChoi].Ngay ~= ThoiGianHienTai.day then
        DemSoLanGui[IDNguoiChoi].SoLan = 0
        DemSoLanGui[IDNguoiChoi].Ngay = ThoiGianHienTai.day
    end

    if DemSoLanGui[IDNguoiChoi].SoLan >= 60 then
        return false
    end

    DemSoLanGui[IDNguoiChoi].SoLan = DemSoLanGui[IDNguoiChoi].SoLan + 1
    return true
end

TabHoTro:AddButton({
    Name = "üì® G·ª≠i Y√™u C·∫ßu",
    Callback = function()
        local NguoiChoi = game.Players.LocalPlayer
        if not KiemTraGioiHan(NguoiChoi) then
            OrionLib:MakeNotification({
                Name = "‚õî B·ªã C·∫•m",
                Content = "B·∫°n ƒë√£ g·ª≠i qu√° 60 y√™u c·∫ßu trong ng√†y!",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
            return
        end

        if NoiDungYeuCau == "" then
            OrionLib:MakeNotification({
                Name = "‚ö† L·ªói",
                Content = "B·∫°n ch∆∞a nh·∫≠p n·ªôi dung y√™u c·∫ßu!",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
            return
        end

        local WebhookURL = "https://discord.com/api/webhooks/1289150124655775775/ipZnrqaXb8cPG3aFmz39d0CAXm2NGX7-RdS-xXev6UZkB-h6qYLYUZ0Gl0KQhNOE6yhU"
        local TenNguoiChoi = NguoiChoi.Name
        local IDNguoiChoi = NguoiChoi.UserId
        local AvatarURL = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. IDNguoiChoi .. "&width=420&height=420&format=png"

        local DuLieu = {
            ["username"] = "Thanh Hub Webhook",
            ["embeds"] = {{
                ["title"] = "üì© Y√™u C·∫ßu M·ªõi T·ª´: " .. TenNguoiChoi .. " (ID: " .. IDNguoiChoi .. ") (t·ª´ Blade Ball)",
                ["description"] = NoiDungYeuCau,
                ["color"] = 16711680,
                ["thumbnail"] = { ["url"] = AvatarURL }
            }}
        }
        local DuLieuJSON = HttpService:JSONEncode(DuLieu)

        local thanhCong, phanHoi = pcall(function()
            return http.request({
                Url = WebhookURL,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = DuLieuJSON
            })
        end)

        if thanhCong then
            OrionLib:MakeNotification({
                Name = "‚úÖ Th√†nh C√¥ng",
                Content = "Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c g·ª≠i!",
                Image = "rbxassetid://4483345998",
                Time = 3
            })
            NoiDungYeuCau = "" -- X√≥a n·ªôi dung sau khi g·ª≠i
        else
            OrionLib:MakeNotification({
                Name = "‚ùå L·ªói",
                Content = "Kh√¥ng th·ªÉ g·ª≠i y√™u c·∫ßu! (Discord Webhook c√≥ th·ªÉ b·ªã ch·∫∑n)",
                Image = "rbxassetid://4483345998",
                Time = 5
            })
        end
    end
})

-- **üî• Hi·ªÉn th·ªã th√¥ng b√°o ch√†o m·ª´ng khi b·∫≠t script**
local function ChayThongBao()
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 400, 0, 100)
    Frame.Position = UDim2.new(0.5, -200, 0.1, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    Frame.BackgroundTransparency = 0.5

    local Label = Instance.new("TextLabel", Frame)
    Label.Size = UDim2.new(1, 0, 1, 0)
    Label.Text = "üéâ Ch√†o M·ª´ng ƒë·∫øn v·ªõi Thanh Hub!"
    Label.TextColor3 = Color3.fromRGB(255, 255, 255)
    Label.Font = Enum.Font.SourceSansBold
    Label.TextSize = 24

    wait(2)
    Label.Text = "Ch√∫c b·∫°n ch∆°i vui v·∫ª"
    wait(2)
    ScreenGui:Destroy()
end
ChayThongBao()

-- **üî• Kh·ªüi ƒë·ªông giao di·ªán GUI**
OrionLib:Init()
