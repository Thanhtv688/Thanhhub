-- **Ki·ªÉm tra map**
local GameID = game.PlaceId
if GameID ~= 13772394625 then
    game.Players.LocalPlayer:Kick("‚ö† Script kh√¥ng ho·∫°t ƒë·ªông cho map n√†y!")
    return
end

local Executor = identifyexecutor and identifyexecutor() or "Unknown"
local BlacklistedExecutors = { "Solara", "Ronix", "Ghost", "Unknown" }
for _, exec in pairs(BlacklistedExecutors) do
    if Executor == exec then
        game.Players.LocalPlayer:Kick("‚ö† Executor kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£!")
        return
    end
end

-- **T·∫£i th∆∞ vi·ªán Fluent UI**
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

-- Th√¥ng b√°o b∆∞·ªõc 1/4
Fluent:Notify({
    Title = "üìö B∆∞·ªõc 1/4: T·∫£i th∆∞ vi·ªán",
    Content = "ƒê√£ t·∫£i xong Fluent UI, SaveManager v√† InterfaceManager.",
    Duration = 2
})

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local UserInputService = game:GetService("UserInputService")

-- **T·∫£i danh s√°ch ban t·ª´ URL**
local BanData
local success, response = pcall(function()
    return game:HttpGet("https://raw.githubusercontent.com/Chubedan3/TH/refs/heads/main/Ban", true)
end)
if success and response then
    local successLoad, data = pcall(loadstring(response))
    if successLoad and type(data) == "table" then
        BanData = data
    end
end
if not BanData then
    BanData = { BanVinhVien = {}, BanTamThoi = {} }
end

-- Th√¥ng b√°o b∆∞·ªõc 2/4
Fluent:Notify({
    Title = "üîí B∆∞·ªõc 2/4: Ki·ªÉm tra ban",
    Content = "ƒê√£ t·∫£i danh s√°ch ban v√† ki·ªÉm tra tr·∫°ng th√°i ng∆∞·ªùi ch∆°i.",
    Duration = 2
})

-- **Ki·ªÉm tra n·∫øu ng∆∞·ªùi ch∆°i b·ªã ban**
local function KiemTraBan()
    local UserID = LocalPlayer.UserId
    for _, ID in pairs(BanData.BanVinhVien) do
        if UserID == ID then
            LocalPlayer:Kick("üö´ B·∫°n ƒë√£ b·ªã ban vƒ©nh vi·ªÖn kh·ªèi Thanh Hub!")
            return true
        end
    end
    if BanData.BanTamThoi[UserID] then
        if os.time() < BanData.BanTamThoi[UserID] then
            LocalPlayer:Kick("‚è≥ B·∫°n b·ªã ban t·∫°m th·ªùi trong 1 ng√†y! H√£y th·ª≠ l·∫°i sau.")
            return true
        else
            BanData.BanTamThoi[UserID] = nil
        end
    end
    return false
end

if KiemTraBan() then return end

-- **G·ª≠i Webhook**
local WebhookURL = game:HttpGet("https://drive.google.com/uc?export=download&id=1wwR25jdkdz8iswuP0PV5Wis_BRX_-MhP")
local TenNguoiChoi = LocalPlayer.Name
local IDNguoiChoi = LocalPlayer.UserId
local AvatarURL = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. IDNguoiChoi .. "&width=420&height=420&format=png"

local DuLieu = {
    ["username"] = "Thanh Hub Webhook",
    ["embeds"] = {{
        ["title"] = "üîç Ki·ªÉm tra ng∆∞·ªùi ch∆°i (t·ª´ Blade Ball)",
        ["description"] = "**T√™n ng∆∞·ªùi ch∆°i:** " .. TenNguoiChoi ..  
                         "\n**ID:** " .. IDNguoiChoi ..  
                         "\n**Executor:** " .. Executor,
        ["color"] = 16776960,
        ["thumbnail"] = { ["url"] = AvatarURL }
    }}
}

local function sendRequest(data)
    local httpRequest = http and http.request or syn and syn.request or request
    if httpRequest then
        httpRequest({
            Url = WebhookURL,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = HttpService:JSONEncode(data)
        })
    end
end

pcall(function() sendRequest(DuLieu) end)

-- **Kh·ªüi t·∫°o GUI v·ªõi Fluent UI**
local Window = Fluent:CreateWindow({
    Title = "Thanh Hub | Blade Ball | v0.3 (Beta)",
    SubTitle = "",
    TabWidth = 160,
    Size = UDim2.fromOffset(450, 300),
    Acrylic = true,
    Theme = "Rose", -- Gi·ªØ giao di·ªán ƒë·ªè nh·∫°t gi·ªëng MM2
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Th√¥ng b√°o b∆∞·ªõc 3/4
Fluent:Notify({
    Title = "üñ•Ô∏è B∆∞·ªõc 3/4: Kh·ªüi t·∫°o GUI",
    Content = "C·ª≠a s·ªï Thanh Hub ƒë√£ ƒë∆∞·ª£c t·∫°o v·ªõi giao di·ªán ƒë·ªè nh·∫°t.",
    Duration = 2
})

local Tabs = {
    Chinh = Window:AddTab({ Title = "üè† Trang Ch√≠nh", Icon = "home" }),
    ChienDau = Window:AddTab({ Title = "‚öî Chi·∫øn ƒê·∫•u", Icon = "sword" }),
    DichChuyen = Window:AddTab({ Title = "üó∫ D·ªãch Chuy·ªÉn", Icon = "map" }),
    CaiDat = Window:AddTab({ Title = "‚öô C√†i ƒê·∫∑t", Icon = "settings" }),
    HoTro = Window:AddTab({ Title = "üì© H·ªó Tr·ª£", Icon = "help-circle" })
}

local Options = Fluent.Options

-- **Tab Trang Ch√≠nh**
Tabs.Chinh:AddParagraph({
    Title = "üîπ Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Thanh Hub Blade Ball!",
    Content = "Ph·∫ßn Ch√≠nh s·∫Ω ƒë∆∞·ª£c update th√™m sau:3"
})

-- **Tab Chi·∫øn ƒê·∫•u**
local Player = Players.LocalPlayer
local Cooldown = tick()
local IsParried = false
local Connection = nil
local AutoParryEnabled = false
local SpamToggleEnabled = false
local AntiCurveEnabled = false
local SpamButton = nil

local function GetBall()
    for _, Ball in ipairs(workspace.Balls:GetChildren()) do
        if Ball:GetAttribute("realBall") then
            return Ball
        end
    end
end

local function ResetConnection()
    if Connection then
        Connection:Disconnect()
        Connection = nil
    end
end

workspace.Balls.ChildAdded:Connect(function()
    if not AutoParryEnabled then return end
    local Ball = GetBall()
    if not Ball then return end
    ResetConnection()
    Connection = Ball:GetAttributeChangedSignal("target"):Connect(function()
        IsParried = false
    end)
end)

RunService.PreSimulation:Connect(function()
    if not AutoParryEnabled then return end
    local Ball = GetBall()
    local HRP = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
    if not Ball or not HRP then return end

    local Speed = Ball.zoomies.VectorVelocity.Magnitude
    local Distance = (HRP.Position - Ball.Position).Magnitude

    if AntiCurveEnabled then
        local BallVelocity = Ball.zoomies.VectorVelocity
        local BallDirection = BallVelocity.Unit
        local PlayerDirection = (HRP.Position - Ball.Position).Unit
        local Angle = BallDirection:Dot(PlayerDirection)
        if Angle < 0.9 then return end
    end

    if Ball:GetAttribute("target") == Player.Name and not IsParried and Distance / Speed <= 0.55 then
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
        IsParried = true
        Cooldown = tick()
    end

    if (tick() - Cooldown) >= 1 then
        IsParried = false
    end
end)

local function CreateSpamButton()
    if SpamButton then return end
    SpamButton = Instance.new("TextButton")
    SpamButton.Name = "SpamToggle"
    SpamButton.Size = UDim2.new(0, 100, 0, 50)
    SpamButton.Position = UDim2.new(0.8, 0, 0.2, 0)
    SpamButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
    SpamButton.Text = "Spam: OFF"
    SpamButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    SpamButton.Font = Enum.Font.SourceSansBold
    SpamButton.TextSize = 20
    SpamButton.Parent = game.CoreGui

    local Dragging = false
    local DragInput, MousePos, FramePos

    SpamButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            MousePos = input.Position
            FramePos = SpamButton.Position
        end
    end)

    SpamButton.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            DragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == DragInput and Dragging then
            local Delta = input.Position - MousePos
            local NewPos = UDim2.new(
                math.clamp(FramePos.X.Scale + Delta.X / game:GetService("Workspace").CurrentCamera.ViewportSize.X, 0, 0.9),
                0,
                math.clamp(FramePos.Y.Scale + Delta.Y / game:GetService("Workspace").CurrentCamera.ViewportSize.Y, 0, 0.9),
                0
            )
            SpamButton.Position = NewPos
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            Dragging = false
        end
    end)

    SpamButton.MouseButton1Click:Connect(function()
        SpamToggleEnabled = not SpamToggleEnabled
        SpamButton.Text = SpamToggleEnabled and "Spam: ON" or "Spam: OFF"
        while SpamToggleEnabled do
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)
            VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 0)
            task.wait()
        end
    end)
end

Tabs.ChienDau:AddToggle("AutoParry", {
    Title = "üõ° Auto Ch√©m",
    Default = false,
    Callback = function(state)
        AutoParryEnabled = state
    end
})

Tabs.ChienDau:AddToggle("AntiCurve", {
    Title = "üéØ Anti B√≥ng Bay Ch√©o/L·ªách h∆∞·ªõng",
    Default = false,
    Callback = function(state)
        AntiCurveEnabled = state
    end
})

Tabs.ChienDau:AddToggle("SpamToggle", {
    Title = "‚ö° T·∫°o n√∫t Spam (s·∫Ω c√≥ trong b·∫£n ch√≠nh th·ª©c)",
    Default = false,
    Callback = function(state)
        if state then CreateSpamButton() end
    end
})

-- **Tab D·ªãch Chuy·ªÉn**
Tabs.DichChuyen:AddButton({
    Title = "üöÄ D·ªãch chuy·ªÉn l√™n cao",
    Description = "D·ªãch chuy·ªÉn l√™n 50 ƒë∆°n v·ªã",
    Callback = function()
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then hrp.CFrame = hrp.CFrame + Vector3.new(0, 50, 0) end
    end
})

-- **Tab C√†i ƒê·∫∑t**
Tabs.CaiDat:AddButton({
    Title = "üîÑ T·∫£i l·∫°i m√°y ch·ªß",
    Description = "T√°i tham gia server",
    Callback = function()
        game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer)
    end
})

-- **Tab H·ªó Tr·ª£**
Tabs.HoTro:AddParagraph({
    Title = "H√£y nh·∫≠p y√™u c·∫ßu ho·∫∑c tr·ª£ gi√∫p v√†o ƒë√¢y",
    Content = "Thanh Hub s·∫Ω xem x√©t v√† c·ªë g·∫Øng th·ª±c hi·ªán ho·∫∑c s·ª≠a l·ªói, l∆∞u √Ω kh√¥ng g·ª≠i nh·ªØng tin nh·∫Øn b·∫≠y b·∫° v√¨ n√≥ s·∫Ω ƒë∆∞·ª£c g·ª≠i cho Thanh Hub n·∫øu kh√¥ng b·∫°n s·∫Ω b·ªã ban kh·ªèi Thanh Hub 1 ng√†y, spam b·∫°n s·∫Ω 5 ti·∫øng"
})

local NoiDungYeuCau = ""
Tabs.HoTro:AddInput("YeuCauInput", {
    Title = "üìú Nh·∫≠p y√™u c·∫ßu ho·∫∑c tr·ª£ gi√∫p",
    Default = "",
    Placeholder = "Nh·∫≠p n·ªôi dung...",
    Callback = function(value)
        NoiDungYeuCau = value
    end
})

local DemSoLanGui = {}
local ThoiGianHienTai = os.date("*t")

local function KiemTraGioiHan(NguoiChoi)
    local IDNguoiChoi = NguoiChoi.UserId
    if not DemSoLanGui[IDNguoiChoi] then
        DemSoLanGui[IDNguoiChoi] = { SoLan = 0, Ngay = ThoiGianHienTai.day }
    end
    if DemSoLanGui[IDNguoiChoi].Ngay ~= ThoiGianHienTai.day then
        DemSoLanGui[IDNguoiChoi].SoLan = 0
        DemSoLanGui[IDNguoiChoi].Ngay = ThoiGianHienTai.day
    end
    if DemSoLanGui[IDNguoiChoi].SoLan >= 60 then return false end
    DemSoLanGui[IDNguoiChoi].SoLan = DemSoLanGui[IDNguoiChoi].SoLan + 1
    return true
end

Tabs.HoTro:AddButton({
    Title = "üì® G·ª≠i Y√™u C·∫ßu",
    Description = "G·ª≠i y√™u c·∫ßu ƒë·∫øn Thanh Hub",
    Callback = function()
        local NguoiChoi = LocalPlayer
        if not KiemTraGioiHan(NguoiChoi) then
            Fluent:Notify({ Title = "‚õî B·ªã C·∫•m", Content = "B·∫°n ƒë√£ g·ª≠i qu√° 60 y√™u c·∫ßu trong ng√†y!", Duration = 5 })
            return
        end
        if NoiDungYeuCau == "" then
            Fluent:Notify({ Title = "‚ö† L·ªói", Content = "B·∫°n ch∆∞a nh·∫≠p n·ªôi dung y√™u c·∫ßu!", Duration = 3 })
            return
        end
        local WebhookURL = game:HttpGet("https://drive.google.com/uc?export=download&id=1wwDQluZHISyNgRUtBbxLjjFxcmHwprZS")
        local TenNguoiChoi = NguoiChoi.Name
        local IDNguoiChoi = NguoiChoi.UserId
        local AvatarURL = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. IDNguoiChoi .. "&width=420&height=420&format=png"
        local DuLieu = {
            ["username"] = "Thanh Hub Webhook",
            ["embeds"] = {{
                ["title"] = "üì© Y√™u C·∫ßu M·ªõi T·ª´: " .. TenNguoiChoi .. " (ID: " .. IDNguoiChoi .. ") (t·ª´ Blade Ball)",
                ["description"] = NoiDungYeuCau,
                ["color"] = 16711680,
                ["thumbnail"] = { ["url"] = AvatarURL }
            }}
        }
        local DuLieuJSON = HttpService:JSONEncode(DuLieu)
        local thanhCong = pcall(function()
            (http and http.request or syn and syn.request or request)({
                Url = WebhookURL,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = DuLieuJSON
            })
        end)
        if thanhCong then
            NoiDungYeuCau = ""
            Options.YeuCauInput:SetValue("")
            Fluent:Notify({ Title = "‚úÖ Th√†nh C√¥ng", Content = "Y√™u c·∫ßu ƒë√£ ƒë∆∞·ª£c g·ª≠i!", Duration = 3 })
        else
            Fluent:Notify({ Title = "‚ùå L·ªói", Content = "Kh√¥ng th·ªÉ g·ª≠i y√™u c·∫ßu! (Webhook l·ªói)", Duration = 5 })
        end
    end
})

-- **Hi·ªÉn th·ªã th√¥ng b√°o ch√†o m·ª´ng**
Fluent:Notify({
    Title = "üéâ Ch√†o M·ª´ng ƒë·∫øn v·ªõi Thanh Hub!",
    Content = "Ch√∫c b·∫°n ch∆°i vui v·∫ª",
    Duration = 4
})

-- **C·∫•u h√¨nh SaveManager v√† InterfaceManager**
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
SaveManager:IgnoreThemeSettings()
SaveManager:SetIgnoreIndexes({})
SaveManager:SetFolder("ThanhHubConfig")
InterfaceManager:SetFolder("ThanhHubConfig")
SaveManager:BuildConfigSection(Tabs.CaiDat)
InterfaceManager:BuildInterfaceSection(Tabs.CaiDat)

-- Th√¥ng b√°o b∆∞·ªõc 4/4
Fluent:Notify({
    Title = "‚úÖ B∆∞·ªõc 4/4: Ho√†n t·∫•t",
    Content = "Thanh Hub ƒë√£ s·∫µn s√†ng ƒë·ªÉ s·ª≠ d·ª•ng!",
    Duration = 3
})

Window:SelectTab(1)
SaveManager:LoadAutoloadConfig()